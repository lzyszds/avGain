"use strict";var Oe=Object.defineProperty;var Se=(e,n,o)=>n in e?Oe(e,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[n]=o;var G=(e,n,o)=>(Se(e,typeof n!="symbol"?n+"":n,o),o);const h=require("electron"),je=require("node:os"),T=require("node:path"),Te=require("events"),m=require("fs"),I=require("path"),Q=require("https"),se=require("element-plus"),De=require("axios"),Ce=require("worker_threads"),Me=require("child_process");var K=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Pe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var le={},ue={},re={};Object.defineProperty(re,"__esModule",{value:!0});const Z=(e,n)=>`${e.id}-${n}`;class ve{constructor(){this.nextId=0,this.storage={},this.owners={},this.electronIds=new WeakMap}add(n,o,i){const l=this.saveToStorage(i),d=Z(n,o);let f=this.owners[d];return f||(f=this.owners[d]=new Map,this.registerDeleteListener(n,o)),f.has(l)||(f.set(l,0),this.storage[l].count++),f.set(l,f.get(l)+1),l}get(n){const o=this.storage[n];if(o!=null)return o.object}remove(n,o,i){const l=Z(n,o),d=this.owners[l];if(d&&d.has(i)){const f=d.get(i)-1;f<=0?(d.delete(i),this.dereference(i)):d.set(i,f)}}clear(n,o){const i=Z(n,o),l=this.owners[i];if(l){for(const d of l.keys())this.dereference(d);delete this.owners[i]}}saveToStorage(n){let o=this.electronIds.get(n);return o||(o=++this.nextId,this.storage[o]={count:0,object:n},this.electronIds.set(n,o)),o}dereference(n){const o=this.storage[n];o!=null&&(o.count-=1,o.count===0&&(this.electronIds.delete(o.object),delete this.storage[n]))}registerDeleteListener(n,o){const i=o.split("-")[0],l=(d,f)=>{f&&f.toString()===i&&(n.removeListener("render-view-deleted",l),this.clear(n,o))};n.on("render-view-deleted",l)}}re.default=new ve;var P={};Object.defineProperty(P,"__esModule",{value:!0});P.deserialize=P.serialize=P.isSerializableObject=P.isPromise=void 0;const We=h;function Be(e){return e&&e.then&&e.then instanceof Function&&e.constructor&&e.constructor.reject&&e.constructor.reject instanceof Function&&e.constructor.resolve&&e.constructor.resolve instanceof Function}P.isPromise=Be;const $e=[Boolean,Number,String,Date,Error,RegExp,ArrayBuffer];function oe(e){return e===null||ArrayBuffer.isView(e)||$e.some(n=>e instanceof n)}P.isSerializableObject=oe;const de=function(e,n){const i=Object.entries(e).map(([l,d])=>[l,n(d)]);return Object.fromEntries(i)};function Fe(e){const n=[],o=e.getScaleFactors();if(o.length===1){const i=o[0],l=e.getSize(i),d=e.toBitmap({scaleFactor:i});n.push({scaleFactor:i,size:l,buffer:d})}else for(const i of o){const l=e.getSize(i),d=e.toDataURL({scaleFactor:i});n.push({scaleFactor:i,size:l,dataURL:d})}return{__ELECTRON_SERIALIZED_NativeImage__:!0,representations:n}}function Le(e){const n=We.nativeImage.createEmpty();if(e.representations.length===1){const{buffer:o,size:i,scaleFactor:l}=e.representations[0],{width:d,height:f}=i;n.addRepresentation({buffer:o,scaleFactor:l,width:d,height:f})}else for(const o of e.representations){const{dataURL:i,size:l,scaleFactor:d}=o,{width:f,height:p}=l;n.addRepresentation({dataURL:i,scaleFactor:d,width:f,height:p})}return n}function ee(e){return e&&e.constructor&&e.constructor.name==="NativeImage"?Fe(e):Array.isArray(e)?e.map(ee):oe(e)?e:e instanceof Object?de(e,ee):e}P.serialize=ee;function te(e){return e&&e.__ELECTRON_SERIALIZED_NativeImage__?Le(e):Array.isArray(e)?e.map(te):oe(e)?e:e instanceof Object?de(e,te):e}P.deserialize=te;var J={};Object.defineProperty(J,"__esModule",{value:!0});J.getElectronBinding=void 0;const ze=e=>process._linkedBinding?process._linkedBinding("electron_common_"+e):process.electronBinding?process.electronBinding(e):null;J.getElectronBinding=ze;(function(e){var n=K&&K.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.initialize=e.isInitialized=e.enable=e.isRemoteModuleEnabled=void 0;const o=Te,i=n(re),l=P,d=h,f=J,{Promise:p}=K,E=f.getElectronBinding("v8_util"),O=(()=>{var t,a;const r=Number((a=(t=process.versions.electron)===null||t===void 0?void 0:t.split("."))===null||a===void 0?void 0:a[0]);return Number.isNaN(r)||r<14})(),y=["length","name","arguments","caller","prototype"],g=new Map,_=new FinalizationRegistry(t=>{const a=t.id[0]+"~"+t.id[1],r=g.get(a);if(r!==void 0&&r.deref()===void 0&&(g.delete(a),!t.webContents.isDestroyed()))try{t.webContents.sendToFrame(t.frameId,"REMOTE_RENDERER_RELEASE_CALLBACK",t.id[0],t.id[1])}catch(c){console.warn(`sendToFrame() failed: ${c}`)}});function w(t){const a=t[0]+"~"+t[1],r=g.get(a);if(r!==void 0){const c=r.deref();if(c!==void 0)return c}}function M(t,a,r,c){const s=new WeakRef(c),u=t[0]+"~"+t[1];return g.set(u,s),_.register(c,{id:t,webContents:a,frameId:r}),c}const C=new WeakMap,V=function(t){let a=Object.getOwnPropertyNames(t);return typeof t=="function"&&(a=a.filter(r=>!y.includes(r))),a.map(r=>{const c=Object.getOwnPropertyDescriptor(t,r);let s,u=!1;return c.get===void 0&&typeof t[r]=="function"?s="method":((c.set||c.writable)&&(u=!0),s="get"),{name:r,enumerable:c.enumerable,writable:u,type:s}})},$=function(t){const a=Object.getPrototypeOf(t);return a===null||a===Object.prototype?null:{members:V(a),proto:$(a)}},b=function(t,a,r,c=!1){let s;switch(typeof r){case"object":r instanceof Buffer?s="buffer":r&&r.constructor&&r.constructor.name==="NativeImage"?s="nativeimage":Array.isArray(r)?s="array":r instanceof Error?s="error":l.isSerializableObject(r)?s="value":l.isPromise(r)?s="promise":Object.prototype.hasOwnProperty.call(r,"callee")&&r.length!=null?s="array":c&&E.getHiddenValue(r,"simple")?s="value":s="object";break;case"function":s="function";break;default:s="value";break}return s==="array"?{type:s,members:r.map(u=>b(t,a,u,c))}:s==="nativeimage"?{type:s,value:l.serialize(r)}:s==="object"||s==="function"?{type:s,name:r.constructor?r.constructor.name:"",id:i.default.add(t,a,r),members:V(r),proto:$(r)}:s==="buffer"?{type:s,value:r}:s==="promise"?(r.then(function(){},function(){}),{type:s,then:b(t,a,function(u,R){r.then(u,R)})}):s==="error"?{type:s,value:r,members:Object.keys(r).map(u=>({name:u,value:b(t,a,r[u])}))}:{type:"value",value:r}},W=function(t){const a=new Error(t);throw a.code="EBADRPC",a.errno=-72,a},N=(t,a)=>{let c=`Attempting to call a function in a renderer window that has been closed or released.
Function provided here: ${C.get(a)}`;if(t instanceof o.EventEmitter){const s=t.eventNames().filter(u=>t.listeners(u).includes(a));s.length>0&&(c+=`
Remote event names: ${s.join(", ")}`,s.forEach(u=>{t.removeListener(u,a)}))}console.warn(c)},Y=(t,a)=>new Proxy(Object,{get(r,c,s){return c==="name"?a:Reflect.get(r,c,s)}}),B=function(t,a,r,c){const s=function(u){switch(u.type){case"nativeimage":return l.deserialize(u.value);case"value":return u.value;case"remote-object":return i.default.get(u.id);case"array":return B(t,a,r,u.value);case"buffer":return Buffer.from(u.value.buffer,u.value.byteOffset,u.value.byteLength);case"promise":return p.resolve({then:s(u.then)});case"object":{const R=u.name!=="Object"?Object.create({constructor:Y(Object,u.name)}):{};for(const{name:L,value:z}of u.members)R[L]=s(z);return R}case"function-with-return-value":{const R=s(u.value);return function(){return R}}case"function":{const R=[r,u.id],L=w(R);if(L!==void 0)return L;const z=function(..._e){let ie=!1;if(!t.isDestroyed())try{ie=t.sendToFrame(a,"REMOTE_RENDERER_CALLBACK",r,u.id,b(t,r,_e))!==!1}catch(Re){console.warn(`sendToFrame() failed: ${Re}`)}ie||N(this,z)};return C.set(z,u.location),Object.defineProperty(z,"length",{value:u.length}),M(R,t,a,z),z}default:throw new TypeError(`Unknown type: ${u.type}`)}};return c.map(s)},k=function(t){const a=t.getLastWebPreferences()||{};return a.enableRemoteModule!=null?!!a.enableRemoteModule:!1},F=new WeakMap,q=function(t){return O&&!F.has(t)&&F.set(t,k(t)),F.get(t)};e.isRemoteModuleEnabled=q;function D(t){F.set(t,!0)}e.enable=D;const S=function(t,a){d.ipcMain.on(t,(r,c,...s)=>{let u;if(!e.isRemoteModuleEnabled(r.sender)){r.returnValue={type:"exception",value:b(r.sender,c,new Error('@electron/remote is disabled for this WebContents. Call require("@electron/remote/main").enable(webContents) to enable it.'))};return}try{u=a(r,c,...s)}catch(R){u={type:"exception",value:b(r.sender,c,R)}}u!==void 0&&(r.returnValue=u)})},v=function(t,a,...r){const c={sender:t,returnValue:void 0,defaultPrevented:!1};return d.app.emit(a,c,t,...r),t.emit(a,c,...r),c},H=function(t,a,r){r&&console.warn(`WebContents (${t.id}): ${a}`,r)};let x=!1;function be(){return x}e.isInitialized=be;function ye(){if(x)throw new Error("@electron/remote has already been initialized");x=!0,S("REMOTE_BROWSER_WRONG_CONTEXT_ERROR",function(t,a,r,c){const u=w([r,c]);u!==void 0&&N(t.sender,u)}),S("REMOTE_BROWSER_REQUIRE",function(t,a,r,c){H(t.sender,`remote.require('${r}')`,c);const s=v(t.sender,"remote-require",r);if(s.returnValue===void 0){if(s.defaultPrevented)throw new Error(`Blocked remote.require('${r}')`);s.returnValue=process.mainModule.require(r)}return b(t.sender,a,s.returnValue)}),S("REMOTE_BROWSER_GET_BUILTIN",function(t,a,r,c){H(t.sender,`remote.getBuiltin('${r}')`,c);const s=v(t.sender,"remote-get-builtin",r);if(s.returnValue===void 0){if(s.defaultPrevented)throw new Error(`Blocked remote.getBuiltin('${r}')`);s.returnValue=h[r]}return b(t.sender,a,s.returnValue)}),S("REMOTE_BROWSER_GET_GLOBAL",function(t,a,r,c){H(t.sender,`remote.getGlobal('${r}')`,c);const s=v(t.sender,"remote-get-global",r);if(s.returnValue===void 0){if(s.defaultPrevented)throw new Error(`Blocked remote.getGlobal('${r}')`);s.returnValue=K[r]}return b(t.sender,a,s.returnValue)}),S("REMOTE_BROWSER_GET_CURRENT_WINDOW",function(t,a,r){H(t.sender,"remote.getCurrentWindow()",r);const c=v(t.sender,"remote-get-current-window");if(c.returnValue===void 0){if(c.defaultPrevented)throw new Error("Blocked remote.getCurrentWindow()");c.returnValue=t.sender.getOwnerBrowserWindow()}return b(t.sender,a,c.returnValue)}),S("REMOTE_BROWSER_GET_CURRENT_WEB_CONTENTS",function(t,a,r){H(t.sender,"remote.getCurrentWebContents()",r);const c=v(t.sender,"remote-get-current-web-contents");if(c.returnValue===void 0){if(c.defaultPrevented)throw new Error("Blocked remote.getCurrentWebContents()");c.returnValue=t.sender}return b(t.sender,a,c.returnValue)}),S("REMOTE_BROWSER_CONSTRUCTOR",function(t,a,r,c){c=B(t.sender,t.frameId,a,c);const s=i.default.get(r);return s==null&&W(`Cannot call constructor on missing remote object ${r}`),b(t.sender,a,new s(...c))}),S("REMOTE_BROWSER_FUNCTION_CALL",function(t,a,r,c){c=B(t.sender,t.frameId,a,c);const s=i.default.get(r);s==null&&W(`Cannot call function on missing remote object ${r}`);try{return b(t.sender,a,s(...c),!0)}catch(u){const R=new Error(`Could not call remote function '${s.name||"anonymous"}'. Check that the function signature is correct. Underlying error: ${u}
`+(u instanceof Error?`Underlying stack: ${u.stack}
`:""));throw R.cause=u,R}}),S("REMOTE_BROWSER_MEMBER_CONSTRUCTOR",function(t,a,r,c,s){s=B(t.sender,t.frameId,a,s);const u=i.default.get(r);return u==null&&W(`Cannot call constructor '${c}' on missing remote object ${r}`),b(t.sender,a,new u[c](...s))}),S("REMOTE_BROWSER_MEMBER_CALL",function(t,a,r,c,s){s=B(t.sender,t.frameId,a,s);const u=i.default.get(r);u==null&&W(`Cannot call method '${c}' on missing remote object ${r}`);try{return b(t.sender,a,u[c](...s),!0)}catch(R){const L=new Error(`Could not call remote method '${c}'. Check that the method signature is correct. Underlying error: ${R}`+(R instanceof Error?`Underlying stack: ${R.stack}
`:""));throw L.cause=R,L}}),S("REMOTE_BROWSER_MEMBER_SET",function(t,a,r,c,s){s=B(t.sender,t.frameId,a,s);const u=i.default.get(r);return u==null&&W(`Cannot set property '${c}' on missing remote object ${r}`),u[c]=s[0],null}),S("REMOTE_BROWSER_MEMBER_GET",function(t,a,r,c){const s=i.default.get(r);return s==null&&W(`Cannot get property '${c}' on missing remote object ${r}`),b(t.sender,a,s[c])}),S("REMOTE_BROWSER_DEREFERENCE",function(t,a,r){i.default.remove(t.sender,a,r)}),S("REMOTE_BROWSER_CONTEXT_RELEASE",(t,a)=>(i.default.clear(t.sender,a),null))}e.initialize=ye})(ue);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.enable=e.isInitialized=e.initialize=void 0;var n=ue;Object.defineProperty(e,"initialize",{enumerable:!0,get:function(){return n.initialize}}),Object.defineProperty(e,"isInitialized",{enumerable:!0,get:function(){return n.isInitialized}}),Object.defineProperty(e,"enable",{enumerable:!0,get:function(){return n.enable}})})(le);var Ae=le;const fe=Pe(Ae);function Ie(e){return m.existsSync(e)?!1:m.existsSync(T.dirname(e))?(m.mkdirSync(e),!0):(m.mkdirSync(T.dirname(e)),!1)}const pe=e=>{const n=T.join(e.getPath("documents"),"javPlayer");return Ie(n),m.writeFileSync(T.join(n,"storeLog.json"),"{}","utf-8"),n};function ae(e){const n=["B","KB","MB","GB","TB"];let o=0;for(;e>=1024&&o<n.length-1;)e/=1024,o++;return e.toFixed(2)+n[o]}function U(e,n,o=!0){if(e.length<=1)return e;const i=e[Math.floor(e.length/2)],l=[],d=[],f=[];for(const p of e){if(!p)break;p[n]<i[n]?l.push(p):p[n]>i[n]?f.push(p):d.push(p)}return o?[...U(l,n,o),...d,...U(f,n,o)]:[...U(f,n,o),...d,...U(l,n,o)]}const Ve=require("superagent"),X=require("fs");function he(e,n,o,i,l,d){return new Promise(async(f,p)=>{const E=__dirname+"../../../electron/";let O;try{O=await Ve.get(i+e[n]).set(l);const y=Buffer.from(O.body);X.appendFile(`${d}/${o}.ts`,y,async g=>{if(g){p(g);return}if(n<e.length)try{const _=E+`/data/data${o}.json`;let w=X.readFileSync(_,"utf-8");w=JSON.parse(w),w.push(n),X.writeFileSync(_,JSON.stringify(w),"utf-8"),await he(e,++n,o,i,l,d)}catch(_){p(_)}else f("下载完成")})}catch(y){p("下载完成"+o+y)}})}async function ce(e,n,o,i){let l;for(let p=0;p<i;p++)m.existsSync(I.join(n,`/${p}.ts`))&&(p===0?l="0.ts":l+=`|${p}.ts`);if(l===void 0)return;const d={maxBuffer:1024*1024*1024,cwd:"L:\\av\\public\\videoDownload"},f=`cd ${n} && ffmpeg -i "concat:${l}" -c copy -bsf:a aac_adtstoasc -movflags +faststart ${o}/${e}.mp4`;return Me.exec(f,d,(p,E,O)=>{if(p){console.log(p);return}console.log("合成成功");for(let y=0;y<20;y++)try{m.unlinkSync(n+`/${y}.ts`)}catch{}}),"合成成功"}class Ne{constructor(n,o,i){G(this,"win");G(this,"app");G(this,"downloadPlanArr");this.win=n,this.app=o,this.downloadPlanArr=[],this.registerHandleWin(),this.registerHandleOpenDir(),this.registerHandleStoreData(),this.registerGetListData(),this.registerDownloadVideoEvent(),this.registerGetDownloadSpeed(),this.registerGetDownloadListContent(),this.registerDeleteDirFile(),this.registerCreateDir()}handleWinAction(n){return new Promise((o,i)=>{switch(n){case"close":this.closeWindow(),o("success");break;case"minimize":this.minimizeWindow(),o("success");break;case"maximize":this.toggleMaximize(),o("success");break;case"changeTheme":this.toggleTheme(),o("success");break;default:i(new Error("Invalid action"))}})}onHandleWin(n,o){this.handleWinAction(o).then(i=>{n.sender.send("onHandleWin",i)}).catch(i=>{n.sender.send("onHandleWin",{error:i.message})})}registerHandleWin(){h.ipcMain.handle("onHandleWin",this.onHandleWin.bind(this))}closeWindow(){this.win=null,process.platform!=="darwin"&&this.app.quit()}minimizeWindow(){var n;(n=this.win)==null||n.minimize()}toggleMaximize(){var n,o,i;(n=this.win)!=null&&n.isMaximized()?(o=this.win)==null||o.unmaximize():(i=this.win)==null||i.maximize()}toggleTheme(){h.nativeTheme.themeSource=h.nativeTheme.shouldUseDarkColors?"light":"dark"}async onHandleOpenDir(n,o){const i=h.dialog.showOpenDialogSync(this.win,{title:"选择文件夹",properties:["openDirectory"],modal:!0});return i&&i.length>0?i[0]:null}registerHandleOpenDir(){h.ipcMain.handle("onHandleOpenDir",this.onHandleOpenDir.bind(this))}async onHandleStoreData(n,o){let i=o,l;const d=I.join(this.app.getPath("documents"),"javPlayer");if(typeof i=="string"){const f=I.join(d,"storeLog.json"),p=m.readFileSync(f,"utf-8");return JSON.parse(p)[i]}else{const f=I.join(d,"storeLog.json"),p=m.readFileSync(f,"utf-8");if(p){const E=JSON.parse(p);l=Object.assign(E,i)}else pe(this.app),l=i;m.writeFileSync(f,JSON.stringify(l),"utf-8")}}registerHandleStoreData(){h.ipcMain.handle("onHandleStoreData",this.onHandleStoreData.bind(this))}async onGetListData(n,o){const i=I.join(this.app.getPath("documents"),"javPlayer"),l=I.join(i,"storeLog.json"),d=m.readFileSync(l,"utf-8"),f=JSON.parse(d),{coverPath:p,previewPath:E,videoPath:O}=f,y=m.readdirSync(p).map(g=>{if(!g.startsWith(".")&&g.indexOf("Thumbs")==0)return null;if(g.indexOf(".png")==-1){const _=g.split(".")[0];_.replaceAll(" ","");let w=null,M=null;try{w=m.statSync(`${O}/${_}.mp4`),M={time:se.dayjs(w.birthtimeMs).format("YYYY-MM-DD HH:mm"),size:ae(w.size)}}catch{w=m.statSync(`${p}/${_}.jpg`),M={time:se.dayjs(w.birthtimeMs).format("YYYY-MM-DD HH:mm"),size:ae(w.size)}}return{stampTime:w?w.birthtimeMs:null,name:_,cover:`${p}/${_}.jpg`,preview:`${E}/${_}.mp4`,url:`${O}/${_}.mp4`,datails:M}}else return null}).filter(g=>g!==null);return U(y.filter(g=>g),"stampTime",!1)}registerGetListData(){h.ipcMain.handle("onGetListData",this.onGetListData.bind(this))}onDownloadVideoEvent(n,o){const i=this;return new Promise(async(l,d)=>{const f=__dirname+"../../../electron/";m.readdirSync(f+"/data").forEach(D=>{m.writeFileSync(f+"/data/"+D,"[]","utf-8")});let{resource:p,name:E,url:O,thread:y,downPath:g,previewPath:_,coverPath:w,videoPath:M}=o;const C=ke(p);E=E.replace("[无码破解]","");const V=He(E);E=E.replace(/[^\u4E00-\u9FA5\u3040-\u309F\u30A0-\u30FF\uFF65-\uFF9Fa-zA-Z0-9/-][\·\・]/g,"").replaceAll(" ","");let $=0,b=null;const W=O.split("/")[O.split("/").length-1].split(".")[0],N=O.split("/").splice(0,O.split("/").length-1).join("/")+"/",{data:Y}=await De(O,{method:"get",headers:C,httpsAgent:new Q.Agent({rejectUnauthorized:!1})}),B=Y.split(`
`).filter(D=>D.indexOf(W)===0),k=Ue(B,y);i.downloadPlanArr=k;let F=!1;if(he(k[0],0,0,N,C,g).then().catch(D=>{D.indexOf("unable to verify the first certificate")!=-1&&(F=!0)}).finally(()=>{++$}),F)return console.log("无法验证第一个证书"),l("无法验证第一个证书");let q=0;for(let D=1;D<y;D++){const S=new Ce.Worker(f+`/seprate/seprateThread${D}.js`);S.on("message",async()=>{++$,b&&clearTimeout(b),b=setTimeout(()=>{if($>=15)return ce(E,g,M,y).then(v=>{v==="合成成功"&&ne(V,E,q,_,w)}),l("下载完成，但是有部分视频没有下载完全")},3*60*1e3),$>=y&&ce(E,g,M,y).then(v=>{if(b&&clearTimeout(b),v==="合成成功")return ne(V,E,q,_,w),l("下载完成")})}),S.postMessage({urlData:k[D],i:D,headers:C,urlPrefix:N,downPath:g})}})}registerDownloadVideoEvent(){h.ipcMain.handle("downloadVideoEvent",this.onDownloadVideoEvent.bind(this))}onGetDownloadSpeed(n,o){const i=__dirname+"../../../electron/";let l=0;m.readdirSync(i+"/data").forEach(f=>{const p=m.readFileSync(i+"/data/"+f,"utf-8");p!=="[]"&&(l+=JSON.parse(p).length)});let d=0;return this.downloadPlanArr.forEach(f=>{d+=f.length}),[l,d||1e3]}registerGetDownloadSpeed(){h.ipcMain.handle("getDownloadSpeed",this.onGetDownloadSpeed.bind(this))}onGetDownloadListContent(n,o){let i=[];return o&&(i=m.readdirSync(o).map(l=>({state:m.statSync(o+"/"+l),name:l}))),i}registerGetDownloadListContent(){h.ipcMain.handle("getDownloadListContent",this.onGetDownloadListContent.bind(this))}onDeleteDirFile(n,o){o&&m.readdirSync(o).forEach(async i=>{await m.unlinkSync(o+"/"+i)})}registerDeleteDirFile(){h.ipcMain.handle("deleteDirFile",this.onDeleteDirFile.bind(this))}onCreateDir(n,o){console.log("lzy  arg:",o),o&&m.mkdirSync(o)}registerCreateDir(){h.ipcMain.handle("onCreateDir",this.onCreateDir.bind(this))}}function ke(e){let n={accept:"*/*","accept-language":"zh-CN,zh;q=0.9,en;q=0.8","sec-ch-ua":'"Not/A)Brand";v="99", "Google Chrome";v="115", "Chromium";v="115"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"Windows"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"cross-site"};return e==="SuperJav"?Object.assign(n,{Referer:"https://emturbovid.com/","Referrer-Policy":"strict-origin-when-cross-origin"}):Object.assign(n,{Origin:"https://missav.com",Referer:"https://missav.com/cn/pppd-985-uncensored-leak"}),n}function He(e){const n=e.indexOf(" ");return e.slice(0,n)}function Ue(e,n){const o=Math.ceil(e.length/n),i=[];for(let l=0;l<e.length;l+=o)i.push(e.slice(l,l+o));return i}function ne(e,n,o,i,l){let d=0;if(o>=5||d>=5)return;const f=`https://cdn82.bestjavcdn.com/${e}/cover.jpg?class=normal`;Q.get(f,p=>{const E=l+"/"+n+".jpg",O=m.createWriteStream(E);p.pipe(O),O.on("finish",()=>{console.log("图片下载成功"),O.close();function y(g){const _=`https://cdn82.bestjavcdn.com/${e}/preview.mp4`;Q.get(_,w=>{const M=i+"/"+n+".mp4",C=m.createWriteStream(M);w.pipe(C),C.on("finish",()=>{console.log("预告片下载成功"),C.close()})}).on("error",w=>{y(),console.error("(即将重试)下载出错:",w)})}y()})}).on("error",p=>{ne(e,n,++o,i,l),console.error("(即将重试)下载出错:",p)})}process.env.DIST_ELECTRON=T.join(__dirname,"..");process.env.DIST=T.join(process.env.DIST_ELECTRON,"../dist");process.env.PUBLIC=process.env.VITE_DEV_SERVER_URL?T.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;global.appRootPath=T.join(__dirname,"../../");je.release().startsWith("6.1")&&h.app.disableHardwareAcceleration();process.platform==="win32"&&h.app.setAppUserModelId(h.app.getName());h.app.requestSingleInstanceLock()||(h.app.quit(),process.exit(0));h.app.commandLine.appendSwitch("enable-experimental-web-platform-features","true");let j=null,A=null;const me=T.join(__dirname,"../preload/index.js"),ge=process.env.VITE_DEV_SERVER_URL,we=T.join(process.env.DIST,"index.html");pe(h.app);fe.initialize();async function Ee(){return j=new h.BrowserWindow({width:1800,height:1e3,minWidth:1260,minHeight:800,title:"avGain",autoHideMenuBar:!0,show:!0,frame:!1,icon:T.join(process.env.PUBLIC,"logo.png"),webPreferences:{devTools:!0,preload:me,webSecurity:!1,nodeIntegration:!1,contextIsolation:!0}}),process.env.VITE_DEV_SERVER_URL?(j.loadURL(ge),j.webContents.openDevTools()):j.loadFile(we),j.webContents.on("did-finish-load",()=>{j==null||j.webContents.send("main-process-message",new Date().toLocaleString())}),j.webContents.setWindowOpenHandler(({url:e})=>(e.startsWith("https:")&&h.shell.openExternal(e),{action:"deny"})),fe.enable(j.webContents),j}h.app.whenReady().then(async()=>{qe(),setTimeout(async()=>{const e=await Ee();new Ne(j,h.app,e),A==null||A.close()},2e3)});h.app.on("window-all-closed",()=>{j=null,process.platform!=="darwin"&&h.app.quit()});h.app.on("second-instance",()=>{j&&(j.isMinimized()&&j.restore(),j.focus())});h.app.on("activate",()=>{const e=h.BrowserWindow.getAllWindows();e.length?e[0].focus():Ee()});h.ipcMain.handle("open-win",(e,n)=>{const o=new h.BrowserWindow({webPreferences:{preload:me,nodeIntegration:!0,contextIsolation:!1}});process.env.VITE_DEV_SERVER_URL?o.loadURL(`${ge}#${n}`):o.loadFile(we,{hash:n})});function qe(){A=new h.BrowserWindow({width:400,height:600,frame:!1,skipTaskbar:!1,transparent:!0,resizable:!1,icon:T.join(process.env.PUBLIC,"logo.png"),webPreferences:{experimentalFeatures:!0,preload:process.env.NODE_ENV==="development"?T.join(h.app.getAppPath(),"preload.js"):T.join(h.app.getAppPath(),"dist/electron/main/preload.js")}}),A.loadFile(T.join(global.appRootPath,"/loader.html")),A.on("closed",()=>{A=null})}
